<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="./style.css" />
    </head>
    <body>
        <div class="output" id="output">

        </div>
        <form
            id="input-form"
        >
            <div class="input-container">
                <span>></span>
                <input id="input"/>
            </div>
        </form>
    </body>
    <script src="./build/browser/nod.js"></script>
    <script>
        // import BrowserClient from './build/browser/nod.js';
        

        const output = document.getElementById('output');

        // const devicesList = document.getElementById('devices');

        // document.getElementById('list-devices').addEventListener('click', async () => {
        //     const devices = (await nod.list()).data;
        //     console.log(devices);
        //     devicesList.innerHTML = '';

        //     const listStr = devices.map((device) => '<li>' + device + '</li>').join();

        //     devicesList.innerHTML = listStr;
        // });

        const inputForm = document.getElementById('input-form');
        const input = document.getElementById('input');

        const stdout = (text, className) => {
            let parsedText = text;
            if(typeof text === 'object') {
                parsedText = '<pre>' + JSON.stringify(text, null, 1) + '</pre>';
            }
            output.innerHTML += `<span ${className ? 'class="' + className + '"' : ''}>` + parsedText + '</span>';
        }

        console.log(nod);
        nod.setName('browser');
        nod.connect().then(async () => {
            stdout('Connected to network');
            const res = await nod.devices(nod.deviceName);
            if(!res.data) {
                stdout('Device not registered, permissions limited', 'warn');
            }
        });

        const commands = {
            'info': (args) => {
                stdout('Browser console is a CMD tool that works in the browser');
            },
            'nod': async (command, ...commandArgs) => {
                const res = await nod[command](...commandArgs);
                console.log(res);
                if(res.data) {
                    stdout(res.data);
                } else {
                    stdout(res.message);
                }
                // stdout('Devices on network:');
                // stdout(res.data.join('</br>'));
            }
        };

        const runCommand = async (fullCommand) => {
            const argv = fullCommand.split(' ');
            const command = argv[0];
            const args = argv.slice(1);
            commands[command](...args);
        }

        inputForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const command = input.value;
            
            runCommand(command).then(() => {
                input.value = '';
            });
            output.scrollTop = output.scrollHeight;

        })
    </script>
</html>